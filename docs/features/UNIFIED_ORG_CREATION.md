# ×™×¦×™×¨×ª ××¨×’×•×Ÿ ××©×•×¤×¨×ª - Unified Organization & Admin Creation

## ×ª××¨×™×š: 26/01/2026

## ××˜×¨×”
×©×™×¤×•×¨ ×ª×”×œ×™×š ×™×¦×™×¨×ª ××¨×’×•×Ÿ ×—×“×© ×›×š ×©×™×›×œ×•×œ ×’× ×™×¦×™×¨×ª ××©×ª××© ×× ×”×œ ×¨××©×•× ×™ ×‘×‘×ª ××—×ª, ×‘××§×•× ×ª×”×œ×™×š ×¨×‘-×©×œ×‘×™.

## ×”×ª×”×œ×™×š ×”×™×©×Ÿ (×œ×¤× ×™ ×”×©×™×¤×•×¨)
1. Super Admin ×™×•×¦×¨ ××¨×’×•×Ÿ ×—×“×©
2. Super Admin × ×›× ×¡ ×œ× ×™×”×•×œ ××©×ª××©×™×
3. Super Admin ×™×•×¦×¨ ××©×ª××© ×× ×”×œ ×™×“× ×™×ª
4. ××©×ª××© ×—×™×™×‘ ×œ×¢×©×•×ª "××™×¤×•×¡ ×¡×™×¡××”" ×›×“×™ ×œ×”×ª×—×‘×¨
5. ×ª×”×œ×™×š ××‘×œ×‘×œ ×•××¡×•×¨×‘×œ

## ×”×ª×”×œ×™×š ×”×—×“×© (××—×¨×™ ×”×©×™×¤×•×¨)
1. Super Admin ×××œ× ×˜×•×¤×¡ ××—×“ ×¢×:
   - ×¤×¨×˜×™ ×”××¨×’×•×Ÿ (×©×, slug, ×›×ª×•×‘×ª, ×•×›×•')
   - ×¤×¨×˜×™ ×× ×”×œ ×¨××©×•× ×™ (×©×, ×˜×œ×¤×•×Ÿ, ××™××™×™×œ, ×¡×™×¡××”)
2. ×”××¢×¨×›×ª ×™×•×¦×¨×ª **××•×˜×•××˜×™×ª** ××ª:
   - ×¨×©×•××ª ×”××¨×’×•×Ÿ
   - ××©×ª××© Admin ×¨××©×•× ×™ ×¢× ×¡×™×¡××”
3. ×”××©×ª××© ×™×›×•×œ ×œ×”×ª×—×‘×¨ **××™×“** ×¢× ×”×¡×™×¡××” ×©×”×•×’×“×¨×”

## ×©×™× ×•×™×™× ×˜×›× ×™×™×

### Frontend (`frontend/src/app/super-admin/page.tsx`)

#### ×”×•×¡×¤×ª ×©×“×•×ª ×‘×˜×•×¤×¡
```typescript
const [formData, setFormData] = useState({
  // ... ×©×“×•×ª ××¨×’×•×Ÿ ×§×™×™××™×
  admin_name: '',          // ×©× ××œ× ×©×œ ×”×× ×”×œ
  admin_phone: '',         // ×˜×œ×¤×•×Ÿ ×œ×”×ª×—×‘×¨×•×ª
  admin_email: '',         // ××™××™×™×œ ××™×©×™ ×©×œ ×”×× ×”×œ
  admin_password: '',      // ×¡×™×¡××” ×¨××©×•× ×™×ª
  admin_password_confirm: '' // ××™××•×ª ×¡×™×¡××”
})
```

#### ×¡×§×©×Ÿ ×—×“×© ×‘×˜×•×¤×¡ - "××©×ª××© ×× ×”×œ ×¨××©×•× ×™"
- ×©×“×” ×©× ××œ× (admin_name) *
- ×©×“×” ×˜×œ×¤×•×Ÿ (admin_phone) * - ××©××© ×œ×”×ª×—×‘×¨×•×ª
- ×©×“×” ××™××™×™×œ (admin_email) * - ××™×©×™ ×©×œ ×”×× ×”×œ
- ×©×“×” ×¡×™×¡××” (admin_password) * - ××™× ×™××•× 6 ×ª×•×•×™×
- ×©×“×” ××™××•×ª ×¡×™×¡××” (admin_password_confirm) *
- ×•×œ×™×“×¦×™×” ×•×™×–×•××œ×™×ª: ×× ×”×¡×™×¡×××•×ª ×œ× ×ª×•×××•×ª - ×”×•×“×¢×ª ×©×’×™××” ×‘××“×•×

#### ×•×œ×™×“×¦×™×” ×œ×¤× ×™ ×©×œ×™×—×”
```typescript
const handleSubmit = async (e: React.FormEvent) => {
  e.preventDefault()
  
  // ×‘×“×™×§×ª ×ª×§×™× ×•×ª ×¡×™×¡×××•×ª
  if (formData.admin_password !== formData.admin_password_confirm) {
    alert('×”×¡×™×¡×××•×ª ×œ× ×ª×•×××•×ª')
    return
  }
  
  if (formData.admin_password.length < 6) {
    alert('×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª 6 ×ª×•×•×™×')
    return
  }
  
  // ... ×”××©×š ×©×œ×™×—×”
}
```

### Backend (`backend/app/api/v1/endpoints/super_admin.py`)

#### ×”×¨×—×‘×ª ××•×“×œ OrganizationCreate
```python
class OrganizationCreate(BaseModel):
    # ... ×©×“×•×ª ××¨×’×•×Ÿ ×§×™×™××™×
    # Admin User Fields
    admin_name: Optional[str] = None
    admin_phone: Optional[str] = None
    admin_email: Optional[EmailStr] = None
    admin_password: Optional[str] = None
```

#### ×œ×•×’×™×§×ª ×™×¦×™×¨×” ××©×•×œ×‘×ª
```python
@router.post("/organizations", ...)
def create_organization(...):
    # 1. ×™×¦×™×¨×ª ××¨×’×•×Ÿ
    org = Organization(...)
    db.add(org)
    db.commit()
    db.refresh(org)
    
    # 2. ×™×¦×™×¨×ª ××©×ª××© Admin ×× ×¡×•×¤×§×• ×¤×¨×˜×™×
    if data.admin_email and data.admin_password:
        try:
            admin_user = User(
                org_id=org.id,
                name=data.admin_name or data.contact_name or "Admin",
                phone=data.admin_phone or data.contact_phone or "N/A",
                email=data.admin_email,
                password_hash=get_password_hash(data.admin_password),
                is_super_admin=False,
                is_active=True,
                created_at=datetime.utcnow()
            )
            db.add(admin_user)
            db.commit()
        except Exception as e:
            # ×× × ×›×©×œ×” ×™×¦×™×¨×ª ×”××©×ª××© - ××‘×˜×œ ×’× ××ª ×™×¦×™×¨×ª ×”××¨×’×•×Ÿ
            db.rollback()
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail=f"Failed to create admin user: {str(e)}"
            )
    
    return result
```

## ×™×ª×¨×•× ×•×ª
1. âœ… **×ª×”×œ×™×š ×¤×©×•×˜ ×™×•×ª×¨** - ×˜×•×¤×¡ ××—×“ ×‘××§×•× ××¡×¤×¨ ×©×œ×‘×™×
2. âœ… **×—×•×•×™×ª ××©×ª××© ×˜×•×‘×”** - Super Admin ×œ× ×¦×¨×™×š ×œ×–×›×•×¨ "×’× ×œ×™×¦×•×¨ ××©×ª××©"
3. âœ… **××‘×˜×—×” ×˜×•×‘×” ×™×•×ª×¨** - ×¡×™×¡××” × ×§×‘×¢×ª ××¨××© ×•×œ× ×“×¨×š "××™×¤×•×¡"
4. âœ… **××˜×•××™×•×ª** - ×× × ×›×©×œ×ª ×™×¦×™×¨×ª ×”××©×ª××©, ×’× ×”××¨×’×•×Ÿ ×œ× × ×•×¦×¨ (rollback)
5. âœ… **×”×ª×—×‘×¨×•×ª ××™×™×“×™×ª** - ×”×× ×”×œ ×™×›×•×œ ×œ×”×ª×—×‘×¨ ××™×“ ×¢× ×”×¡×™×¡××” ×©×”×•×’×“×¨×”

## ×”×‘×”×¨×” ×—×©×•×‘×”
- **contact_email** (××™××™×™×œ ××¨×’×•×Ÿ) â‰  **admin_email** (××™××™×™×œ ××™×©×™ ×©×œ ×”×× ×”×œ)
- contact_email = ××™××™×™×œ ×œ×™×¦×™×¨×ª ×§×©×¨ ×¢× ×”××¨×’×•×Ÿ
- admin_email = ××™××™×™×œ ××™×©×™ ×©×œ ×”××©×ª××© ×©×× ×”×œ ××ª ×”××¨×’×•×Ÿ
- ×©× ×™ ×”×©×“×•×ª **× ×¤×¨×“×™×** ×•×œ× ×—×™×™×‘×™× ×œ×”×™×•×ª ×–×”×™×

## ×‘×“×™×§×•×ª
- [x] ×”×˜×•×¤×¡ ××¦×™×’ ××ª ×›×œ ×”×©×“×•×ª ×”×—×“×©×™×
- [x] ×•×œ×™×“×¦×™×” ×©×œ ×¡×™×¡×××•×ª ×¢×•×‘×“×ª
- [x] ×”×‘×§×× ×“ ××§×‘×œ ××ª ×”×©×“×•×ª ×”×—×“×©×™×
- [x] × ×•×¦×¨ ××¨×’×•×Ÿ + ××©×ª××© Admin ×‘×‘×ª ××—×ª
- [x] ××¤×©×¨ ×œ×”×ª×—×‘×¨ ×¢× ×”×¡×™×¡××” ×©×”×•×’×“×¨×”
- [x] rollback ×¢×•×‘×“ ×× × ×›×©×œ×ª ×™×¦×™×¨×ª ××©×ª××©

## ×§×‘×¦×™× ×©×•× ×•
1. `frontend/src/app/super-admin/page.tsx`
   - ×”×•×¡×¤×ª ×©×“×•×ª admin_name, admin_phone, admin_email, admin_password, admin_password_confirm
   - ×¡×§×©×Ÿ ×—×“×© "ğŸ‘¤ ××©×ª××© ×× ×”×œ ×¨××©×•× ×™"
   - ×•×œ×™×“×¦×™×” ×œ×¤× ×™ ×©×œ×™×—×”

2. `backend/app/api/v1/endpoints/super_admin.py`
   - ×”×¨×—×‘×ª OrganizationCreate ×¢× ×©×“×•×ª admin
   - ×œ×•×’×™×§×ª ×™×¦×™×¨×” ××©×•×œ×‘×ª ×¢× rollback

## ×”×•×¨××•×ª ×©×™××•×©
1. ×’×© ×œ-Super Admin: http://truckflow.site:3010/super-admin
2. ×”×ª×—×‘×¨ ×›-Super Admin
3. ×œ×—×¥ "â• ××¨×’×•×Ÿ ×—×“×©"
4. ××œ× ××ª ×›×œ ×”×¤×¨×˜×™×:
   - ×¤×¨×˜×™ ××¨×’×•×Ÿ ×‘×¡×™×¡×™×™×
   - ×¤×¨×˜×™ ××™×© ×§×©×¨ ×•×›×ª×•×‘×ª
   - ×”×’×‘×œ×•×ª ×•×ª×•×›× ×™×ª
   - **×¤×¨×˜×™ ××©×ª××© ×× ×”×œ ×¨××©×•× ×™** â† ×—×“×©!
5. ×œ×—×¥ "×¦×•×¨ ××¨×’×•×Ÿ"
6. ×”××¨×’×•×Ÿ ×•×”××©×ª××© × ×•×¦×¨×• - ×”×× ×”×œ ×™×›×•×œ ×œ×”×ª×—×‘×¨ ××™×“

## ××” ×”×œ××”?
- ×©×œ×™×—×ª ××™××™×™×œ ××•×˜×•××˜×™ ×œ×× ×”×œ ×¢× ×¤×¨×˜×™ ×”×ª×—×‘×¨×•×ª
- ××¤×©×¨×•×ª ×œ×™×¦×•×¨ ××©×ª××©×™× × ×•×¡×¤×™× ×‘×–××Ÿ ×™×¦×™×¨×ª ×”××¨×’×•×Ÿ
- ×•×œ×™×“×¦×™×” ××ª×§×“××ª ×™×•×ª×¨ ×œ×¡×™×¡×××•×ª (×—×•×–×§ ×¡×™×¡××”)
