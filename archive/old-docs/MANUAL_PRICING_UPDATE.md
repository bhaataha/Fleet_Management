# ✅ מחיר מותאם אישית - הושלם!

## מה עודכן?

### 🎯 דף צפייה בנסיעה (`/jobs/[id]`)

**עכשיו מציג מחיר נכון לפי עדיפות:**

1. **יש מחיר ידני?** → תיבה **צהובה/כתומה** גדולה:
   - ✅ "מחיר מותאם אישית"
   - ⚠️ "מחיר זה עוקף את המחירון ומשמש לחיוב בפועל"
   - מחיר בולט וגדול
   - סיבה (אם קיימת)
   - מחיר ממחירון מוסתר ב-`<details>` לעיון בלבד

2. **אין מחיר ידני?** → תיבה **כחולה** רגילה:
   - "מחיר ממחירון"
   - פירוט מחיר בסיס × כמות + תוספות

---

### 💼 דוחות - שימוש במחיר הנכון!

#### חשבוניות ללקוח (Statements)
**קובץ**: `backend/app/api/v1/endpoints/statements.py`

**עדיפות חדשה**:
```python
amount = (
    job.manual_override_total    # ראשון: מחיר ידני
    or job.pricing_total          # שני: מחיר ממחירון
    or fallback                   # שלישי: חישוב גיבוי
)
```

✅ **תוצאה**: חשבוניות מציגות מחיר ידני אם קיים

---

#### דוחות קבלני משנה
**קובץ**: `backend/app/api/v1/endpoints/subcontractors.py`

**עדיפות חדשה**:
```python
total_company_price = sum(
    (j.manual_override_total or j.pricing_total or 0) 
    for j in jobs
)
```

✅ **תוצאה**: 
- רווחיות מחושבת נכון
- `profit = company_price (עם manual) - subcontractor_price`

---

## 📊 תרחיש לדוגמה

### נסיעה #68
- **מחיר ממחירון**: ₪3,500 (140/טון × 25 טון)
- **מחיר מותאם אישית**: ₪4,200
- **סיבה**: "הנחה מיוחדת ללקוח VIP"

**מה יקרה?**

1. **דף צפייה** (`/jobs/68`):
   - ✅ תיבה צהובה עם ₪4,200 גדול ובולט
   - ⚠️ אזהרה שזה המחיר הסופי
   - מחיר ממחירון (₪3,500) מוסתר בפתיחה

2. **תעודת משלוח PDF**:
   - ✅ קטע "מחיר" צהוב עם ₪4,200
   - ✅ סיבה: "הנחה מיוחדת ללקוח VIP"

3. **חשבונית ללקוח**:
   - ✅ נסיעה #68: ₪4,200 (לא ₪3,500!)

4. **דוח קבלן משנה** (אם נסיעה של קבלן):
   - ✅ חיוב ללקוח: ₪4,200
   - תשלום לקבלן: ₪3,000
   - **רווח**: ₪1,200 (לא ₪500!)

---

## 🎨 למה צהוב?

- **צהוב/כתום** = אזהרה/חריגה מהרגיל
- מחיר ידני הוא **חריג** מהמחירון הרגיל
- **בולט מאוד** כדי שלא יהיה בלבול

---

## 📚 תיעוד מלא

קובץ: `/docs/features/MANUAL_PRICING_OVERRIDE.md`

כולל:
- ✅ הסבר מפורט על כל שינוי
- ✅ דוגמאות קוד
- ✅ תרחישי בדיקה
- ✅ הערות למפתחים
- ✅ איך למצוא עוד מקומות שצריכים עדכון

---

## 🚀 מה עכשיו?

1. **רענן דפדפן** (Ctrl+Shift+R)
2. **פתח נסיעה שיש בה manual_override_total**
3. **תראה תיבה צהובה גדולה עם המחיר הידני!**
4. **צור Statement** - וודא שמחיר ידני מופיע בשורת הנסיעה

---

## ⚠️ חשוב!

**מחיר מותאם אישית עוקף הכל:**
- ✅ תצוגה בממשק
- ✅ תעודת משלוח PDF
- ✅ חשבוניות ללקוח
- ✅ דוחות קבלני משנה
- ✅ דוחות רווחיות

**זה המחיר הסופי והמחייב!**

